'use strict';const a17_0x109af8=a17_0x28a0;(function(_0x287a1e,_0x239569){const _0x17a72c=a17_0x28a0,_0x43b15c=_0x287a1e();while(!![]){try{const _0xe92480=parseInt(_0x17a72c(0xd5))/0x1*(-parseInt(_0x17a72c(0xe0))/0x2)+parseInt(_0x17a72c(0x109))/0x3*(-parseInt(_0x17a72c(0x10d))/0x4)+parseInt(_0x17a72c(0x103))/0x5*(parseInt(_0x17a72c(0xb3))/0x6)+-parseInt(_0x17a72c(0x117))/0x7*(-parseInt(_0x17a72c(0xd8))/0x8)+parseInt(_0x17a72c(0xfd))/0x9+-parseInt(_0x17a72c(0xdc))/0xa+-parseInt(_0x17a72c(0xfe))/0xb*(-parseInt(_0x17a72c(0xff))/0xc);if(_0xe92480===_0x239569)break;else _0x43b15c['push'](_0x43b15c['shift']());}catch(_0x140845){_0x43b15c['push'](_0x43b15c['shift']());}}}(a17_0x575e,0xb53b3));function a17_0x28a0(_0x3bea84,_0x4d6d56){const _0x575e55=a17_0x575e();return a17_0x28a0=function(_0x28a0bc,_0x43a0cf){_0x28a0bc=_0x28a0bc-0xb1;let _0x322c35=_0x575e55[_0x28a0bc];return _0x322c35;},a17_0x28a0(_0x3bea84,_0x4d6d56);}var __awaiter=this&&this[a17_0x109af8(0xfc)]||function(_0x291b05,_0xf67ba5,_0x4d34ce,_0x3540ae){function _0x176393(_0x8e07c7){return _0x8e07c7 instanceof _0x4d34ce?_0x8e07c7:new _0x4d34ce(function(_0x1ba180){_0x1ba180(_0x8e07c7);});}return new(_0x4d34ce||(_0x4d34ce=Promise))(function(_0x3f9b27,_0x18c5c0){const _0x5ae641=a17_0x28a0;function _0x1b905a(_0x45f319){const _0x27fbca=a17_0x28a0;try{_0x287e2c(_0x3540ae[_0x27fbca(0xc6)](_0x45f319));}catch(_0x539800){_0x18c5c0(_0x539800);}}function _0x115ea1(_0x50d316){const _0x5a9271=a17_0x28a0;try{_0x287e2c(_0x3540ae[_0x5a9271(0xd7)](_0x50d316));}catch(_0x42e00f){_0x18c5c0(_0x42e00f);}}function _0x287e2c(_0x2e1089){const _0x31a537=a17_0x28a0;_0x2e1089[_0x31a537(0xc5)]?_0x3f9b27(_0x2e1089[_0x31a537(0xdf)]):_0x176393(_0x2e1089['value'])[_0x31a537(0xd2)](_0x1b905a,_0x115ea1);}_0x287e2c((_0x3540ae=_0x3540ae[_0x5ae641(0xd4)](_0x291b05,_0xf67ba5||[]))[_0x5ae641(0xc6)]());});},__importDefault=this&&this[a17_0x109af8(0xf5)]||function(_0x5958fa){const _0x47b434=a17_0x109af8;return _0x5958fa&&_0x5958fa[_0x47b434(0xe3)]?_0x5958fa:{'default':_0x5958fa};};function a17_0x575e(){const _0x3c7566=['CAMDIGIKEY_CLIENT_ID','export','9568076NWIWcy','oids','/api/v1.5/oauth2/client-lib/logout-access-token','2616fxXuIA','Invalid\x20user\x20access\x20token\x20signature.','binary','CAMDIGIKEY_CLIENT_TRUST_STORE_FILE_PASSWORD','default','now','readFileSync','signerCertificate','getBags','/api/v1.5/oauth2/client-lib/user-info','./error/CamDigiKeyError','invalid.token.format','spki','./error/InvalidTokenSignatureError','node-forge','CAMDIGIKEY_SERVER_BASED_URL','./crypto/DigestHelper','CamDigiKeyClient','done','next','end','ORG_ACCESS_TOKEN_URL','X509Certificate','ACCESS_TOKEN_STATUS_URL','./cache/CamDigiKeyMemoryCache','init','CAMDIGIKEY_CLIENT_KEYSTORE_FILE_PASSWORD','pkcs12FromAsn1','getBytes','refreshUserAccessToken','base64','then','message','apply','32498EvGsne','includes','throw','8itAGAF','_cacheService','requestToServer','CAMDIGIKEY_CLIENT_DOMAIN','10545570IZhOjh','encode','CAMDIGIKEY_CLIENT_KEYSTORE_FILE','value','88BBKsKJ','env','statusCode','__esModule','/api/v1.5/certificates/access-token-certificate-chain','logoutAccessToken','split','/api/v1.5/oauth2/client-lib/status-org-access-token','LOGOUT_USER_ACCESS_TOKEN_URL','CAMDIGIKEY_CLIENT_TRUST_STORE_FILE','ACCESS_TOKEN_REFRESH_URL','publicKey','/api/v1.5/oauth2/client-lib/login-token','agentOptions','LOGIN_TOKEN_REQUEST_URL','unwrapResponse','asn1','sha512','fromDer','string','wrapRequest','__importDefault','getOrganizationAccessToken','/api/v1.5/oauth2/client-lib/verify-user-profile','./error/InvalidAccessTokenTypeError','from','crypto','ACCESS_TOKEN_REQUEST_URL','__awaiter','4011831PkMflv','10988065tKZNdr','12qSPlzM','request','/api/v1.5/oauth2/client-lib/refresh-access-token','Invalid\x20access\x20token\x20signature','7125XdjVDa','verify','validateTokenSignature','toDer','length','data','47550tVfpyq','certBag','status','pem','52NrWWgv','application/json','_trustedRootCert','pki','post','LOOKUP_USER_PROFILE','getUserAccessToken','./crypto/Wrapper'];a17_0x575e=function(){return _0x3c7566;};return a17_0x575e();}Object['defineProperty'](exports,a17_0x109af8(0xe3),{'value':!![]}),exports[a17_0x109af8(0xc4)]=void 0x0;const Wrapper_1=__importDefault(require(a17_0x109af8(0x114))),CamDigiKeyError_1=__importDefault(require(a17_0x109af8(0xbd))),InvalidAccessTokenTypeError_1=__importDefault(require(a17_0x109af8(0xf8))),DigestHelper_1=__importDefault(require(a17_0x109af8(0xc3))),CamDigiKeyMemoryCache_1=__importDefault(require(a17_0x109af8(0xcb))),InvalidTokenSignatureError_1=__importDefault(require(a17_0x109af8(0xc0))),fs_1=__importDefault(require('fs')),request_1=__importDefault(require(a17_0x109af8(0x100))),crypto_1=__importDefault(require(a17_0x109af8(0xfa))),node_forge_1=__importDefault(require(a17_0x109af8(0xc1))),CAMDIGIKEY_API={'LOGIN_TOKEN_REQUEST_URL':a17_0x109af8(0xec),'ACCESS_TOKEN_REQUEST_URL':'/api/v1.5/oauth2/client-lib/access-token','USER_INFO_REQUEST_URL':a17_0x109af8(0xbc),'ACCESS_TOKEN_STATUS_URL':'/api/v1.5/oauth2/client-lib/status-access-token','ORG_ACCESS_TOKEN_URL':'/api/v1.5/oauth2/client-lib/organization-access-token','ORG_ACCESS_TOKEN_STATUS_URL':a17_0x109af8(0xe7),'LOGOUT_USER_ACCESS_TOKEN_URL':a17_0x109af8(0xb2),'LOOKUP_USER_PROFILE':'/api/v1.5/oauth2/client-lib/user-lookup-profile','VERIFY_USER_PROFILE':a17_0x109af8(0xf7),'ACCESS_TOKEN_REFRESH_URL':a17_0x109af8(0x101),'ACCESS_TOKEN_CERT_URL':a17_0x109af8(0xe4)};class CamDigiKeyClient{static['init'](){const _0x7d8d29=a17_0x109af8,_0x1a0fe6=fs_1[_0x7d8d29(0xb7)][_0x7d8d29(0xb9)](String(process[_0x7d8d29(0xe1)][_0x7d8d29(0xe9)]),_0x7d8d29(0xb5)),_0x211f27=node_forge_1[_0x7d8d29(0xb7)][_0x7d8d29(0xf0)][_0x7d8d29(0xf2)](_0x1a0fe6),_0x32311b=node_forge_1[_0x7d8d29(0xb7)]['pkcs12'][_0x7d8d29(0xce)](_0x211f27,String(process[_0x7d8d29(0xe1)][_0x7d8d29(0xb6)])),_0x471279=_0x32311b[_0x7d8d29(0xbb)]({'bagType':node_forge_1['default'][_0x7d8d29(0x110)][_0x7d8d29(0xb1)]['certBag']}),_0x548c84=_0x471279[node_forge_1[_0x7d8d29(0xb7)][_0x7d8d29(0x110)][_0x7d8d29(0xb1)][_0x7d8d29(0x10a)]][0x0],_0x56e524={'type':'CERTIFICATE','body':node_forge_1['default']['asn1'][_0x7d8d29(0x106)](_0x548c84[_0x7d8d29(0xf0)])[_0x7d8d29(0xcf)]()},_0x10f1ac=node_forge_1[_0x7d8d29(0xb7)][_0x7d8d29(0x10c)][_0x7d8d29(0xdd)](_0x56e524);this[_0x7d8d29(0x10f)]=new crypto_1['default'][(_0x7d8d29(0xc9))](_0x10f1ac),this['_cacheService']=new CamDigiKeyMemoryCache_1[(_0x7d8d29(0xb7))](this[_0x7d8d29(0x10f)]);}static[a17_0x109af8(0xda)](_0x3aa665,_0x5bddf3){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x3664eb=a17_0x28a0;try{const _0x315cb5=String(process[_0x3664eb(0xe1)][_0x3664eb(0xc2)])+_0x5bddf3,_0x552cb4=Wrapper_1[_0x3664eb(0xb7)][_0x3664eb(0xf4)](_0x3aa665),_0x4e603={'url':_0x315cb5,'headers':{'Content-Type':_0x3664eb(0x10e)},'json':_0x552cb4};return process['env'][_0x3664eb(0xde)]&&(_0x4e603[_0x3664eb(0xed)]={'pfx':fs_1[_0x3664eb(0xb7)][_0x3664eb(0xb9)](String(process['env'][_0x3664eb(0xde)])),'passphrase':String(process[_0x3664eb(0xe1)][_0x3664eb(0xcd)])}),yield new Promise(_0x4fbbac=>{const _0xde116f=_0x3664eb;request_1[_0xde116f(0xb7)][_0xde116f(0x111)](_0x4e603,(_0x31e2ad,_0x428ac0,_0x481f09)=>{const _0x21f211=_0xde116f;if(!_0x31e2ad){if(_0x428ac0['statusCode']>=0xc8&&_0x428ac0[_0x21f211(0xe2)]<0x12c){if(_0x481f09!=null)try{const _0x3d5c47=Wrapper_1[_0x21f211(0xb7)][_0x21f211(0xef)](_0x481f09);return _0x4fbbac(_0x3d5c47);}catch(_0x2b05ea){throw _0x2b05ea;}else return _0x4fbbac({});}throw new CamDigiKeyError_1[(_0x21f211(0xb7))]('Error\x20requesting\x20to\x20CamDigiKey\x20Server.');}else throw new CamDigiKeyError_1[(_0x21f211(0xb7))](_0x31e2ad['message']);});});}catch(_0x33a66d){throw new CamDigiKeyError_1['default'](_0x33a66d[_0x3664eb(0xd3)]);}});}static[a17_0x109af8(0x105)](_0x238a5b){var _0x313495;return __awaiter(this,void 0x0,void 0x0,function*(){const _0x220650=a17_0x28a0;!this[_0x220650(0xd9)]&&CamDigiKeyClient[_0x220650(0xcc)]();if(typeof _0x238a5b!==_0x220650(0xf3))throw new InvalidAccessTokenTypeError_1[(_0x220650(0xb7))]('invalid.token.type');_0x238a5b[_0x220650(0xd6)]('%')&&(_0x238a5b=decodeURIComponent(_0x238a5b));try{const _0x27b515=_0x238a5b[_0x220650(0xe6)]('.');if(_0x27b515[_0x220650(0x107)]!==0x3)throw new InvalidAccessTokenTypeError_1[(_0x220650(0xb7))](_0x220650(0xbe));const _0x6934f6=_0x27b515[0x0]+'.'+_0x27b515[0x1],_0x50baa2=DigestHelper_1[_0x220650(0xb7)]['digest'](Buffer[_0x220650(0xf9)](_0x6934f6)),_0x5de964=yield(_0x313495=this[_0x220650(0xd9)])===null||_0x313495===void 0x0?void 0x0:_0x313495[_0x220650(0xba)](),_0x5c8abc=Buffer['from'](_0x27b515[0x2],_0x220650(0xd1)),_0x328817=_0x5de964===null||_0x5de964===void 0x0?void 0x0:_0x5de964[_0x220650(0xeb)],_0x2b4264=_0x328817[_0x220650(0x116)]({'type':_0x220650(0xbf),'format':'pem'}),_0x2a54c0=crypto_1[_0x220650(0xb7)]['createVerify'](_0x220650(0xf1));_0x2a54c0['write'](_0x50baa2),_0x2a54c0[_0x220650(0xc7)]();const _0x211073=_0x2a54c0[_0x220650(0x104)](Buffer['from'](_0x2b4264),_0x5c8abc);return _0x211073;}catch(_0x4e8f5b){return console['error'](_0x4e8f5b),![];}});}static['validateJwt'](_0x1a0edf){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x48e9df=a17_0x28a0;if(yield this[_0x48e9df(0x105)](_0x1a0edf)){_0x1a0edf[_0x48e9df(0xd6)]('%')&&(_0x1a0edf=decodeURIComponent(_0x1a0edf));const _0x6d91c2={'clientId':process['env'][_0x48e9df(0x115)],'accessToken':_0x1a0edf};try{let _0x257640=yield this['requestToServer'](_0x6d91c2,CAMDIGIKEY_API[_0x48e9df(0xca)]);if(_0x257640[_0x48e9df(0x108)][_0x48e9df(0x10b)])return{'is_valid':!![],'payload':_0x257640};}catch(_0x4cf40f){}}return{'is_valid':![],'payload':null};});}static[a17_0x109af8(0xf6)](){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x345dd8=a17_0x28a0,_0x263e37={'clientId':process[_0x345dd8(0xe1)][_0x345dd8(0x115)],'domain':process[_0x345dd8(0xe1)][_0x345dd8(0xdb)],'requestedDate':Date[_0x345dd8(0xb8)]()};return yield this[_0x345dd8(0xda)](_0x263e37,CAMDIGIKEY_API[_0x345dd8(0xc8)]);});}static['getLoginToken'](){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x47e070=a17_0x28a0,_0x38d779={'clientId':process[_0x47e070(0xe1)][_0x47e070(0x115)],'domain':process['env']['CAMDIGIKEY_CLIENT_DOMAIN'],'requestedDate':Date[_0x47e070(0xb8)]()};return yield this[_0x47e070(0xda)](_0x38d779,CAMDIGIKEY_API[_0x47e070(0xee)]);});}static[a17_0x109af8(0x113)](_0x2301d9){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x3646d1=a17_0x28a0;if(!(yield this[_0x3646d1(0x105)](_0x2301d9)))throw new InvalidTokenSignatureError_1[(_0x3646d1(0xb7))]('Invalid\x20auth\x20token\x20signature.');_0x2301d9[_0x3646d1(0xd6)]('%')&&(_0x2301d9=decodeURIComponent(_0x2301d9));const _0x5f1115={'clientId':process[_0x3646d1(0xe1)][_0x3646d1(0x115)],'authToken':_0x2301d9};return yield this[_0x3646d1(0xda)](_0x5f1115,CAMDIGIKEY_API[_0x3646d1(0xfb)]);});}static[a17_0x109af8(0xd0)](_0x221593){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x4e5d8a=a17_0x28a0;if(!(yield this[_0x4e5d8a(0x105)](_0x221593)))throw new InvalidTokenSignatureError_1['default'](_0x4e5d8a(0xb4));_0x221593[_0x4e5d8a(0xd6)]('%')&&(_0x221593=decodeURIComponent(_0x221593));const _0x24dd6e={'clientId':process['env'][_0x4e5d8a(0x115)],'accessToken':_0x221593};return yield this[_0x4e5d8a(0xda)](_0x24dd6e,CAMDIGIKEY_API[_0x4e5d8a(0xea)]);});}static[a17_0x109af8(0xe5)](_0x5912bb){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x2149dd=a17_0x28a0;if(!(yield this[_0x2149dd(0x105)](_0x5912bb)))throw new InvalidTokenSignatureError_1[(_0x2149dd(0xb7))](_0x2149dd(0xb4));_0x5912bb[_0x2149dd(0xd6)]('%')&&(_0x5912bb=decodeURIComponent(_0x5912bb));const _0x203e71={'clientId':process['env']['CAMDIGIKEY_CLIENT_ID'],'accessToken':_0x5912bb};return yield this[_0x2149dd(0xda)](_0x203e71,CAMDIGIKEY_API[_0x2149dd(0xe8)]);});}static['lookupUserProfile'](_0x3cd294,_0x9a0481){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x1d7db2=a17_0x28a0;if(!(yield this[_0x1d7db2(0x105)](_0x3cd294)))throw new InvalidTokenSignatureError_1[(_0x1d7db2(0xb7))](_0x1d7db2(0x102));_0x3cd294[_0x1d7db2(0xd6)]('%')&&(_0x3cd294=decodeURIComponent(_0x3cd294));const _0xa638a2={'clientId':process[_0x1d7db2(0xe1)][_0x1d7db2(0x115)],'domain':process[_0x1d7db2(0xe1)][_0x1d7db2(0xdb)],'accessToken':_0x3cd294,'personalCode':_0x9a0481};return yield this['requestToServer'](_0xa638a2,CAMDIGIKEY_API[_0x1d7db2(0x112)]);});}static['verifyAccountToken'](_0x46e777){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x516bc6=a17_0x28a0;if(!(yield this['validateTokenSignature'](_0x46e777)))throw new InvalidTokenSignatureError_1[(_0x516bc6(0xb7))](_0x516bc6(0x102));_0x46e777[_0x516bc6(0xd6)]('%')&&(_0x46e777=decodeURIComponent(_0x46e777));const _0x16d31b={'clientId':process[_0x516bc6(0xe1)][_0x516bc6(0x115)],'domain':process[_0x516bc6(0xe1)]['CAMDIGIKEY_CLIENT_DOMAIN'],'accountToken':_0x46e777};return yield this[_0x516bc6(0xda)](_0x16d31b,CAMDIGIKEY_API['VERIFY_USER_PROFILE']);});}}exports['CamDigiKeyClient']=CamDigiKeyClient;