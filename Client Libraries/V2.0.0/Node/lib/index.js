'use strict';const a18_0x50a8dd=a18_0x57a3;(function(_0x2ca7ca,_0x30be5a){const _0x14488b=a18_0x57a3,_0x1c8d88=_0x2ca7ca();while(!![]){try{const _0x48feeb=parseInt(_0x14488b(0x1b5))/0x1*(-parseInt(_0x14488b(0x18e))/0x2)+-parseInt(_0x14488b(0x1e2))/0x3*(-parseInt(_0x14488b(0x190))/0x4)+parseInt(_0x14488b(0x1ab))/0x5*(-parseInt(_0x14488b(0x18c))/0x6)+parseInt(_0x14488b(0x18d))/0x7+-parseInt(_0x14488b(0x1bb))/0x8+-parseInt(_0x14488b(0x1e6))/0x9*(parseInt(_0x14488b(0x1bd))/0xa)+parseInt(_0x14488b(0x1c7))/0xb;if(_0x48feeb===_0x30be5a)break;else _0x1c8d88['push'](_0x1c8d88['shift']());}catch(_0x643806){_0x1c8d88['push'](_0x1c8d88['shift']());}}}(a18_0x5cba,0x3e06c));var __awaiter=this&&this[a18_0x50a8dd(0x1bc)]||function(_0x487502,_0x1a2f7d,_0x1897f0,_0xd6e5c6){function _0xee4e05(_0x728ce0){return _0x728ce0 instanceof _0x1897f0?_0x728ce0:new _0x1897f0(function(_0x14c15c){_0x14c15c(_0x728ce0);});}return new(_0x1897f0||(_0x1897f0=Promise))(function(_0x421623,_0x5d6a0e){function _0x166786(_0x26a5a0){const _0x235012=a18_0x57a3;try{_0x11f46e(_0xd6e5c6[_0x235012(0x198)](_0x26a5a0));}catch(_0x794dc8){_0x5d6a0e(_0x794dc8);}}function _0x1a488d(_0x23f818){try{_0x11f46e(_0xd6e5c6['throw'](_0x23f818));}catch(_0x54de65){_0x5d6a0e(_0x54de65);}}function _0x11f46e(_0x2f4da7){const _0x16a83f=a18_0x57a3;_0x2f4da7[_0x16a83f(0x1ce)]?_0x421623(_0x2f4da7[_0x16a83f(0x1ad)]):_0xee4e05(_0x2f4da7['value'])[_0x16a83f(0x1a8)](_0x166786,_0x1a488d);}_0x11f46e((_0xd6e5c6=_0xd6e5c6['apply'](_0x487502,_0x1a2f7d||[]))['next']());});},__importDefault=this&&this[a18_0x50a8dd(0x1c2)]||function(_0x4251dc){const _0x407802=a18_0x50a8dd;return _0x4251dc&&_0x4251dc[_0x407802(0x19c)]?_0x4251dc:{'default':_0x4251dc};};Object[a18_0x50a8dd(0x1c9)](exports,a18_0x50a8dd(0x19c),{'value':!![]}),exports[a18_0x50a8dd(0x19a)]=void 0x0;function a18_0x57a3(_0x57a4aa,_0x35310b){const _0x5cba32=a18_0x5cba();return a18_0x57a3=function(_0x57a32e,_0x34da86){_0x57a32e=_0x57a32e-0x189;let _0x437f90=_0x5cba32[_0x57a32e];return _0x437f90;},a18_0x57a3(_0x57a4aa,_0x35310b);}function a18_0x5cba(){const _0x4d42e3=['init\x20called','certBag','init','spki','binary','LOGIN_TOKEN_REQUEST_URL','then','lookupUserProfile','./api','443335jptBbz','statusCode','value','getBags','publicKey','agentOptions','encode','length','application/json','data','1WUAFYO','ORG_ACCESS_TOKEN_URL','CAMDIGIKEY_CLIENT_TRUST_STORE_FILE_PASSWORD','./error/CamDigiKeyError','_cacheService','sha512','3260312JFvjTn','__awaiter','134380nULFLr','end','Invalid\x20user\x20access\x20token\x20signature.','split','./error/InvalidTokenSignatureError','__importDefault','Invalid\x20auth\x20token\x20signature.','unwrapResponse','asn1','getUserAccessToken','10875865OodoyE','getOrganizationAccessToken','defineProperty','X509Certificate','validateJwt','_trustedRootCert','now','done','CAMDIGIKEY_CLIENT_KEYSTORE_FILE','Invalid\x20access\x20token\x20signature','crypto','wrapRequest','ACCESS_TOKEN_STATUS_URL','CAMDIGIKEY_API','export','readFileSync','node-forge','from','requestToServer','includes','default','fromDer','CAMDIGIKEY_CLIENT_ID','verifyAccountToken','digest','ACCESS_TOKEN_REQUEST_URL','post','597099NGCYFo','request','CAMDIGIKEY_CLIENT_KEYSTORE_FILE_PASSWORD','getLoginToken','81cWieqK','./cache/CamDigiKeyMemoryCache','invalid.token.format','validateTokenSignature','env','CAMDIGIKEY_CLIENT_DOMAIN','pem','toDer','verify','18LuUEOE','1896797ICifJJ','820354TBkYEZ','invalid.token.type','4hqSCSt','ACCESS_TOKEN_REFRESH_URL','refreshUserAccessToken','CERTIFICATE','./crypto/Wrapper','logoutAccessToken','Error\x20requesting\x20to\x20CamDigiKey\x20Server.','base64','next','CAMDIGIKEY_CLIENT_TRUST_STORE_FILE','CamDigiKeyClient','oids','__esModule','LOGOUT_USER_ACCESS_TOKEN_URL','pkcs12','error','pki','message'];a18_0x5cba=function(){return _0x4d42e3;};return a18_0x5cba();}const Wrapper_1=__importDefault(require(a18_0x50a8dd(0x194))),CamDigiKeyError_1=__importDefault(require(a18_0x50a8dd(0x1b8))),InvalidAccessTokenTypeError_1=__importDefault(require('./error/InvalidAccessTokenTypeError')),DigestHelper_1=__importDefault(require('./crypto/DigestHelper')),CamDigiKeyMemoryCache_1=__importDefault(require(a18_0x50a8dd(0x1e7))),InvalidTokenSignatureError_1=__importDefault(require(a18_0x50a8dd(0x1c1))),fs_1=__importDefault(require('fs')),request_1=__importDefault(require(a18_0x50a8dd(0x1e3))),crypto_1=__importDefault(require(a18_0x50a8dd(0x1d1))),node_forge_1=__importDefault(require(a18_0x50a8dd(0x1d7))),api_1=require(a18_0x50a8dd(0x1aa)),CamDigiKeyClient=class{static[a18_0x50a8dd(0x1a4)](){const _0x3c594c=a18_0x50a8dd;console['log'](_0x3c594c(0x1a2));const _0x44c119=fs_1[_0x3c594c(0x1db)][_0x3c594c(0x1d6)](String(process['env'][_0x3c594c(0x199)]),_0x3c594c(0x1a6)),_0x110b80=node_forge_1[_0x3c594c(0x1db)][_0x3c594c(0x1c5)][_0x3c594c(0x1dc)](_0x44c119),_0x4e02e2=node_forge_1[_0x3c594c(0x1db)][_0x3c594c(0x19e)]['pkcs12FromAsn1'](_0x110b80,String(process[_0x3c594c(0x1ea)][_0x3c594c(0x1b7)])),_0x1471ad=_0x4e02e2[_0x3c594c(0x1ae)]({'bagType':node_forge_1[_0x3c594c(0x1db)]['pki'][_0x3c594c(0x19b)][_0x3c594c(0x1a3)]}),_0x3314cf=_0x1471ad[node_forge_1[_0x3c594c(0x1db)][_0x3c594c(0x1a0)]['oids'][_0x3c594c(0x1a3)]][0x0],_0x5c4dbb={'type':_0x3c594c(0x193),'body':node_forge_1[_0x3c594c(0x1db)][_0x3c594c(0x1c5)][_0x3c594c(0x18a)](_0x3314cf[_0x3c594c(0x1c5)])['getBytes']()},_0x4a5941=node_forge_1[_0x3c594c(0x1db)][_0x3c594c(0x189)][_0x3c594c(0x1b1)](_0x5c4dbb);this['_trustedRootCert']=new crypto_1[(_0x3c594c(0x1db))][(_0x3c594c(0x1ca))](_0x4a5941),this[_0x3c594c(0x1b9)]=new CamDigiKeyMemoryCache_1['default'](this[_0x3c594c(0x1cc)]);}static['requestToServer'](_0x1e4147,_0x2907fc){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x115c07=a18_0x57a3;try{const _0x360d5b=String(process['env']['CAMDIGIKEY_SERVER_BASED_URL'])+_0x2907fc,_0xfbe452=Wrapper_1[_0x115c07(0x1db)][_0x115c07(0x1d2)](_0x1e4147),_0x5c468e={'url':_0x360d5b,'headers':{'Content-Type':_0x115c07(0x1b3)},'json':_0xfbe452};return process[_0x115c07(0x1ea)][_0x115c07(0x1cf)]&&(_0x5c468e[_0x115c07(0x1b0)]={'pfx':fs_1[_0x115c07(0x1db)][_0x115c07(0x1d6)](String(process[_0x115c07(0x1ea)][_0x115c07(0x1cf)])),'passphrase':String(process[_0x115c07(0x1ea)][_0x115c07(0x1e4)])}),yield new Promise(_0x34b8e=>{const _0x5081ac=_0x115c07;request_1[_0x5081ac(0x1db)][_0x5081ac(0x1e1)](_0x5c468e,(_0x58bc2c,_0x539f19,_0x5c575d)=>{const _0x26247c=_0x5081ac;if(!_0x58bc2c){if(_0x539f19[_0x26247c(0x1ac)]>=0xc8&&_0x539f19[_0x26247c(0x1ac)]<0x12c){if(_0x5c575d!=null)try{const _0x1c2a97=Wrapper_1['default'][_0x26247c(0x1c4)](_0x5c575d);return _0x34b8e(_0x1c2a97);}catch(_0x28d51c){throw _0x28d51c;}else return _0x34b8e({});}throw new CamDigiKeyError_1['default'](_0x26247c(0x196));}else throw new CamDigiKeyError_1[(_0x26247c(0x1db))](_0x58bc2c[_0x26247c(0x1a1)]);});});}catch(_0x53db0e){throw new CamDigiKeyError_1[(_0x115c07(0x1db))](_0x53db0e[_0x115c07(0x1a1)]);}});}static['validateTokenSignature'](_0x147bde){var _0x7de724;return __awaiter(this,void 0x0,void 0x0,function*(){const _0x3d4aaa=a18_0x57a3;!this[_0x3d4aaa(0x1b9)]&&this[_0x3d4aaa(0x1a4)]();if(typeof _0x147bde!=='string')throw new InvalidAccessTokenTypeError_1[(_0x3d4aaa(0x1db))](_0x3d4aaa(0x18f));_0x147bde[_0x3d4aaa(0x1da)]('%')&&(_0x147bde=decodeURIComponent(_0x147bde));try{const _0x570995=_0x147bde[_0x3d4aaa(0x1c0)]('.');if(_0x570995[_0x3d4aaa(0x1b2)]!==0x3)throw new InvalidAccessTokenTypeError_1[(_0x3d4aaa(0x1db))](_0x3d4aaa(0x1e8));const _0x420a6c=_0x570995[0x0]+'.'+_0x570995[0x1],_0x779946=DigestHelper_1[_0x3d4aaa(0x1db)][_0x3d4aaa(0x1df)](Buffer['from'](_0x420a6c)),_0x1bda5d=yield(_0x7de724=this['_cacheService'])===null||_0x7de724===void 0x0?void 0x0:_0x7de724['signerCertificate'](),_0x3009ab=Buffer[_0x3d4aaa(0x1d8)](_0x570995[0x2],_0x3d4aaa(0x197)),_0x38f90b=_0x1bda5d===null||_0x1bda5d===void 0x0?void 0x0:_0x1bda5d[_0x3d4aaa(0x1af)],_0x1ce4e7=_0x38f90b[_0x3d4aaa(0x1d5)]({'type':_0x3d4aaa(0x1a5),'format':'pem'}),_0x5e5d5f=crypto_1['default']['createVerify'](_0x3d4aaa(0x1ba));_0x5e5d5f['write'](_0x779946),_0x5e5d5f[_0x3d4aaa(0x1be)]();const _0x494e31=_0x5e5d5f[_0x3d4aaa(0x18b)](Buffer[_0x3d4aaa(0x1d8)](_0x1ce4e7),_0x3009ab);return _0x494e31;}catch(_0x15311a){return console[_0x3d4aaa(0x19f)](_0x15311a),![];}});}static[a18_0x50a8dd(0x1cb)](_0x249992){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x2767d6=a18_0x57a3;if(yield this[_0x2767d6(0x1e9)](_0x249992)){_0x249992[_0x2767d6(0x1da)]('%')&&(_0x249992=decodeURIComponent(_0x249992));const _0x1ace5e={'clientId':process['env']['CAMDIGIKEY_CLIENT_ID'],'accessToken':_0x249992};try{let _0x462c51=yield this[_0x2767d6(0x1d9)](_0x1ace5e,api_1[_0x2767d6(0x1d4)][_0x2767d6(0x1d3)]);if(_0x462c51[_0x2767d6(0x1b4)]['status'])return{'is_valid':!![],'payload':_0x462c51};}catch(_0x4e2f33){}}return{'is_valid':![],'payload':null};});}static[a18_0x50a8dd(0x1c8)](){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x33a10b=a18_0x57a3,_0x454901={'clientId':process[_0x33a10b(0x1ea)]['CAMDIGIKEY_CLIENT_ID'],'domain':process[_0x33a10b(0x1ea)][_0x33a10b(0x1eb)],'requestedDate':Date[_0x33a10b(0x1cd)]()};return yield this[_0x33a10b(0x1d9)](_0x454901,api_1['CAMDIGIKEY_API'][_0x33a10b(0x1b6)]);});}static[a18_0x50a8dd(0x1e5)](){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x3bf1fe=a18_0x57a3,_0xe38a6b={'clientId':process[_0x3bf1fe(0x1ea)]['CAMDIGIKEY_CLIENT_ID'],'domain':process[_0x3bf1fe(0x1ea)]['CAMDIGIKEY_CLIENT_DOMAIN'],'requestedDate':Date[_0x3bf1fe(0x1cd)]()};return yield this[_0x3bf1fe(0x1d9)](_0xe38a6b,api_1[_0x3bf1fe(0x1d4)][_0x3bf1fe(0x1a7)]);});}static[a18_0x50a8dd(0x1c6)](_0x3c0e65){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x472dce=a18_0x57a3;if(!(yield this[_0x472dce(0x1e9)](_0x3c0e65)))throw new InvalidTokenSignatureError_1[(_0x472dce(0x1db))](_0x472dce(0x1c3));_0x3c0e65[_0x472dce(0x1da)]('%')&&(_0x3c0e65=decodeURIComponent(_0x3c0e65));const _0x22f19b={'clientId':process['env'][_0x472dce(0x1dd)],'authToken':_0x3c0e65};return yield this[_0x472dce(0x1d9)](_0x22f19b,api_1[_0x472dce(0x1d4)][_0x472dce(0x1e0)]);});}static[a18_0x50a8dd(0x192)](_0x31d0fc){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x34c446=a18_0x57a3;if(!(yield this['validateTokenSignature'](_0x31d0fc)))throw new InvalidTokenSignatureError_1[(_0x34c446(0x1db))](_0x34c446(0x1bf));_0x31d0fc['includes']('%')&&(_0x31d0fc=decodeURIComponent(_0x31d0fc));const _0x1aa231={'clientId':process[_0x34c446(0x1ea)][_0x34c446(0x1dd)],'accessToken':_0x31d0fc};return yield this[_0x34c446(0x1d9)](_0x1aa231,api_1['CAMDIGIKEY_API'][_0x34c446(0x191)]);});}static[a18_0x50a8dd(0x195)](_0x5bdd81){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x259adb=a18_0x57a3;if(!(yield this['validateTokenSignature'](_0x5bdd81)))throw new InvalidTokenSignatureError_1[(_0x259adb(0x1db))]('Invalid\x20user\x20access\x20token\x20signature.');_0x5bdd81[_0x259adb(0x1da)]('%')&&(_0x5bdd81=decodeURIComponent(_0x5bdd81));const _0x595c3d={'clientId':process[_0x259adb(0x1ea)][_0x259adb(0x1dd)],'accessToken':_0x5bdd81};return yield this['requestToServer'](_0x595c3d,api_1[_0x259adb(0x1d4)][_0x259adb(0x19d)]);});}static[a18_0x50a8dd(0x1a9)](_0x26038a,_0x34e3e7){return __awaiter(this,void 0x0,void 0x0,function*(){const _0xc360ea=a18_0x57a3;if(!(yield this['validateTokenSignature'](_0x26038a)))throw new InvalidTokenSignatureError_1[(_0xc360ea(0x1db))](_0xc360ea(0x1d0));_0x26038a[_0xc360ea(0x1da)]('%')&&(_0x26038a=decodeURIComponent(_0x26038a));const _0x42c850={'clientId':process['env'][_0xc360ea(0x1dd)],'domain':process[_0xc360ea(0x1ea)][_0xc360ea(0x1eb)],'accessToken':_0x26038a,'personalCode':_0x34e3e7};return yield this['requestToServer'](_0x42c850,api_1[_0xc360ea(0x1d4)]['LOOKUP_USER_PROFILE']);});}static[a18_0x50a8dd(0x1de)](_0x8b6af7){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x3db265=a18_0x57a3;if(!(yield this[_0x3db265(0x1e9)](_0x8b6af7)))throw new InvalidTokenSignatureError_1[(_0x3db265(0x1db))](_0x3db265(0x1d0));_0x8b6af7[_0x3db265(0x1da)]('%')&&(_0x8b6af7=decodeURIComponent(_0x8b6af7));const _0x285469={'clientId':process[_0x3db265(0x1ea)][_0x3db265(0x1dd)],'domain':process['env']['CAMDIGIKEY_CLIENT_DOMAIN'],'accountToken':_0x8b6af7};return yield this[_0x3db265(0x1d9)](_0x285469,api_1['CAMDIGIKEY_API']['VERIFY_USER_PROFILE']);});}};exports[a18_0x50a8dd(0x19a)]=CamDigiKeyClient;